<Window x:Class="WpfClient.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Paint - Joystick Control"
        Width="1100"
        Height="820"
        MinWidth="1100"
        MinHeight="820"
        Background="{DynamicResource WindowBackgroundBrush}"
        WindowStartupLocation="CenterScreen">
    <Window.Resources>
        <LinearGradientBrush x:Key="WindowBackgroundBrush" StartPoint="0,0" EndPoint="1,1">
            <GradientStop Color="#F7F9FC" Offset="0" />
            <GradientStop Color="#E3EAF7" Offset="1" />
        </LinearGradientBrush>

        <DropShadowEffect x:Key="MediumShadow" BlurRadius="16" ShadowDepth="4" Opacity="0.25" />
        <DropShadowEffect x:Key="SoftShadow" BlurRadius="12" ShadowDepth="2" Opacity="0.18" />
        <BooleanToVisibilityConverter x:Key="BoolToVisibility" />

        <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="#1F2430" />
            <Setter Property="FontFamily" Value="Segoe UI" />
        </Style>

        <Style x:Key="PaletteItemContainerStyle" TargetType="ListBoxItem">
            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
            <Setter Property="Margin" Value="0,0,0,12" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="FocusVisualStyle" Value="{x:Null}" />
        </Style>

        <DataTemplate x:Key="PaletteItemTemplate">
            <Border Height="40"
                    Width="40"
                    Background="{Binding Brush}"
                    CornerRadius="8"
                    ToolTip="{Binding Name}"
                    Effect="{StaticResource SoftShadow}">
                <Border.BorderBrush>
                    <SolidColorBrush Color="#33000000" />
                </Border.BorderBrush>
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="BorderThickness" Value="2" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=ListBoxItem}}" Value="True">
                                <Setter Property="BorderBrush" Value="#FF4B9EFF" />
                                <Setter Property="BorderThickness" Value="4" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
            </Border>
        </DataTemplate>
    </Window.Resources>

    <Grid>
        <Border Width="1000"
                Height="700"
                CornerRadius="24"
                Background="White"
                Effect="{StaticResource MediumShadow}"
                HorizontalAlignment="Center"
                VerticalAlignment="Center">
            <Canvas Width="1000" Height="700" Background="Transparent">
                <!-- Header -->
                <TextBlock Canvas.Left="32" Canvas.Top="24"
                           Text="Paint Receiver"
                           FontSize="32"
                           FontWeight="SemiBold" />
                <TextBlock Canvas.Left="32" Canvas.Top="66"
                           Text="Раскрашивание с управлением джойстиком"
                           FontSize="16"
                           Foreground="#5C6475" />

                <!-- Picture info -->
                <StackPanel Canvas.Left="32" Canvas.Top="112">
                    <TextBlock Text="Картинка:" FontWeight="SemiBold" FontSize="14" />
                    <TextBlock Text="{Binding PictureDisplayName}" FontSize="20" FontWeight="SemiBold" Margin="0,4,0,12" />
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <Border Width="18" Height="18" Background="{Binding SelectedColorBrush}" CornerRadius="9" />
                        <TextBlock Text="{Binding SelectedColorName}" FontSize="16" Margin="8,0,0,0" />
                        <TextBlock Text="({Binding SelectedColorHex})"
                                   FontSize="12" Foreground="#7A859A" Margin="8,2,0,0" />
                    </StackPanel>
                    <TextBlock Text="Позиция курсора:" FontSize="14" FontWeight="SemiBold" Margin="0,16,0,0" />
                    <TextBlock Text="{Binding CursorPosition}" FontSize="16" />
                    <TextBlock Text="{Binding ConnectionStatus}" FontSize="12" Foreground="#7A859A" Margin="0,12,0,0" />
                </StackPanel>

                <!-- Reference image -->
                <TextBlock Canvas.Left="780" Canvas.Top="0"
                           Text="Образец"
                           FontSize="14"
                           FontWeight="SemiBold"
                           Foreground="#5C6475" />
                <Border Canvas.Left="780" Canvas.Top="20"
                        Width="200"
                        Height="200"
                        CornerRadius="18"
                        Background="#F1F4FA"
                        Padding="12"
                        Effect="{StaticResource SoftShadow}">
                    <Image Source="{Binding ReferenceImage}" Stretch="Uniform" />
                </Border>

                <!-- Color palette -->
                <TextBlock Canvas.Left="900" Canvas.Top="220"
                           Text="Цвета"
                           FontWeight="SemiBold"
                           FontSize="16" />
                <ListBox Canvas.Left="900"
                         Canvas.Top="250"
                         Width="40"
                         Height="360"
                         ItemsSource="{Binding Palette}"
                         ItemTemplate="{StaticResource PaletteItemTemplate}"
                         ItemContainerStyle="{StaticResource PaletteItemContainerStyle}"
                         SelectedIndex="{Binding SelectedColorIndex, Mode=TwoWay}"
                         Background="Transparent"
                         BorderThickness="0" />

                <!-- Filled figures -->
                <Border Canvas.Left="760" Canvas.Top="440" Width="220" Height="220"
                        Background="#F7F9FD"
                        CornerRadius="16"
                        Padding="16"
                        Effect="{StaticResource SoftShadow}">
                    <StackPanel>
                        <TextBlock Text="Залитые фигуры" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,12" />
                        <TextBlock Text="{Binding FilledCount, StringFormat=Всего: {0}}" FontSize="12" Foreground="#7A859A" Margin="0,0,0,8" />
                        <ItemsControl ItemsSource="{Binding FilledFigures}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="White" CornerRadius="8" Padding="8" Margin="0,0,0,8" Effect="{StaticResource SoftShadow}">
                                        <TextBlock Text="{Binding}" FontSize="12" />
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>

                <!-- Main canvas -->
                <Border Canvas.Left="200"
                        Canvas.Top="50"
                        Width="600"
                        Height="600"
                        CornerRadius="24"
                        Background="#FBFCFF"
                        BorderBrush="#D5DFF1"
                        BorderThickness="2"
                        Effect="{StaticResource SoftShadow}">
                    <Grid>
                        <Image Source="{Binding CanvasImage}" Stretch="Fill" />
                    </Grid>
                </Border>

                <!-- Cursor -->
                <Ellipse Width="{Binding CursorDiameter}"
                         Height="{Binding CursorDiameter}"
                         Stroke="#FF4B9EFF"
                         StrokeThickness="2"
                         Canvas.Left="{Binding CursorLeft}"
                         Canvas.Top="{Binding CursorTop}"
                         Fill="{x:Null}" />
                <Ellipse Width="4" Height="4" Fill="#FF4B9EFF"
                         Canvas.Left="{Binding CursorInnerLeft}"
                         Canvas.Top="{Binding CursorInnerTop}" />

                <!-- Instructions -->
                <TextBlock Canvas.Left="32" Canvas.Top="620"
                           Text="A/D — выбрать цвет | B — залить фигуру | C — очистить фигуру"
                           FontSize="14"
                           Foreground="#5C6475" />
                <TextBlock Canvas.Left="32" Canvas.Top="644"
                           Text="E — следующая картинка | F — очистить всё"
                           FontSize="14"
                           Foreground="#5C6475" />

                <!-- Status message -->
                <Border Canvas.Left="32"
                        Canvas.Top="680"
                        Width="600"
                        Height="44"
                        CornerRadius="12"
                        Background="#EFF3FB"
                        Visibility="{Binding HasStatusMessage, Converter={StaticResource BoolToVisibility}}"
                        Padding="16,8"
                        Effect="{StaticResource SoftShadow}">
                    <TextBlock Text="{Binding StatusMessage}" FontSize="14" />
                </Border>
            </Canvas>
        </Border>
    </Grid>
</Window>
