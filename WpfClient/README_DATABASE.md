# База данных для записи и воспроизведения действий

## Установка и запуск MySQL

1. Убедитесь, что у вас установлен Docker и Docker Compose.

2. Запустите MySQL контейнер:
```bash
docker-compose up -d
```

3. Проверьте, что контейнер запущен:
```bash
docker ps
```

4. Для остановки контейнера:
```bash
docker-compose down
```

5. Для остановки с удалением данных:
```bash
docker-compose down -v
```

## Структура базы данных

### Таблица `sessions`
Содержит информацию о сессиях рисования:
- `id` - уникальный идентификатор сессии
- `started_at` - время начала сессии
- `ended_at` - время окончания сессии (может быть NULL)
- `drawing_key` - ключ текущего рисунка

### Таблица `actions`
Содержит все действия пользователя:
- `id` - уникальный идентификатор действия
- `session_id` - ссылка на сессию
- `action_type` - тип действия (cursor_move, color_select, fill, clear_figure, next_picture, clear_all)
- `timestamp_ms` - время с начала сессии в миллисекундах
- `occurred_at` - абсолютное время действия
- `cursor_x`, `cursor_y` - координаты курсора
- `canvas_x`, `canvas_y` - координаты на холсте
- `color_index` - индекс выбранного цвета
- `color_hex` - hex-код цвета
- `figure_name` - название фигуры (для fill/clear_figure)
- `button_pressed` - нажатая кнопка (A, B, C, D, E, F)
- `raw_x`, `raw_y` - сырые значения с джойстика
- `additional_data` - дополнительные данные в JSON

## Использование в приложении

### Запись действий

1. Запустите приложение
2. Нажмите кнопку "○ Запись остановлена" для начала записи (кнопка станет зеленой "● Запись")
3. Выполняйте действия с джойстиком (движение курсора, выбор цвета, заливка фигур и т.д.)
4. Все действия автоматически сохраняются в базу данных
5. Нажмите кнопку снова для остановки записи

### Воспроизведение (Демо режим)

1. Нажмите кнопку "Демо режим"
2. Выберите сессию из списка доступных сессий
3. Нажмите "Воспроизвести"
4. Приложение автоматически воспроизведет все действия в той же последовательности и с теми же временными интервалами

## Подключение к базе данных

- **Host**: localhost
- **Port**: 3307 (внешний порт контейнера, внутренний порт MySQL - 3306)
- **Database**: paintdb
- **Username**: paintuser
- **Password**: paintpassword
- **Root Password**: rootpassword

> **Примечание**: Порт изменен на 3307, чтобы избежать конфликта с локально установленным MySQL (если он использует стандартный порт 3306).

## Настройка подключения

Настройки подключения можно изменить в файле `DatabaseConfig.cs`:

```csharp
public const string Server = "localhost";
public const int Port = 3307;
public const string Database = "paintdb";
public const string User = "paintuser";
public const string Password = "paintpassword";
```

Соответствующие изменения также нужно внести в файл `docker-compose.yml` (поле `ports` в формате `"3307:3306"`).

